version: '3'

services:
  druid-zookeeper:
    stdin_open: true
    tty: true
    image: zookeeper:3.4.14
    container_name: druid-zookeeper
    restart: always
    ports:
      - "2181:2181"
    networks:
      - zenatix-docker

  druid-coordinator:
    stdin_open: true
    tty: true
    image: deepaksood619/zendruid:2.0.0
    container_name: druid-coordinator
    restart: always
    volumes:
      - druid-volume:/var/druid
    ports:
      - "8081:8081"
    entrypoint: ["bash", "-c", "bin/run-druid coordinator /druid/conf"]
    depends_on:
      - druid-postgresql
      - druid-zookeeper
    networks:
      - zenatix-docker

  druid-overlord:
    stdin_open: true
    tty: true
    image: deepaksood619/zendruid:2.0.0
    container_name: druid-overlord
    restart: always
    volumes:
      - druid-volume:/var/druid
    ports:
      - "8090:8090"
    entrypoint: ["bash", "-c", "bin/run-druid overlord /druid/conf"]
    networks:
      - zenatix-docker

  druid-middlemanager:
    stdin_open: true
    tty: true
    image: deepaksood619/zendruid:2.0.0
    container_name: druid-middlemanager
    restart: always
    volumes:
      - druid-volume:/var/druid
    ports:
      - "8091:8091"
    entrypoint: ["bash", "-c", "bin/run-druid middleManager /druid/conf"]
    depends_on:
      - druid-overlord
    networks:
      - zenatix-docker

  druid-historical:
    stdin_open: true
    tty: true
    image: deepaksood619/zendruid:2.0.0
    container_name: druid-historical
    restart: always
    entrypoint: ["bash", "-c", "bin/run-druid historical /druid/conf"]
    depends_on:
      - druid-overlord
      - druid-middlemanager
      - druid-coordinator
    ports:
      - "8083:8083"
    volumes:
      - druid-volume:/var/druid
    networks:
      - zenatix-docker

  druid-broker:
    stdin_open: true
    tty: true
    image: deepaksood619/zendruid:2.0.0
    container_name: druid-broker
    restart: always
    volumes:
      - druid-volume:/var/druid
    entrypoint: ["bash", "-c", "bin/run-druid broker /druid/conf"]
    depends_on:
      - druid-coordinator
    ports:
      - "8082:8082"
    networks:
      - zenatix-docker

  druid-router:
    stdin_open: true
    tty: true
    image: deepaksood619/zendruid:2.0.0
    container_name: druid-router
    restart: always
    entrypoint: ["bash", "-c", "bin/run-druid router /druid/conf"]
    depends_on:
      - druid-broker
    ports:
      - "8888:8888"
    networks:
      - zenatix-docker

  druid-postgresql:
    stdin_open: true
    tty: true
    image: library/postgres:latest
    container_name: druid-postgresql
    restart: always
    environment:
      - POSTGRES_USER=druid
      - POSTGRES_PASSWORD=diurd
      - POSTGRES_DB=druid
    ports:
      - "5436:5432"
    volumes:
        - postgresql-druid-volume:/var/lib/postgresql/data
    networks:
      - zenatix-docker

networks:
    zenatix-docker:
        external:
            name: zenatix-docker

volumes:
    postgresql-druid-volume:

    druid-volume:
        external: true
